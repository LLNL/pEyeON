{
  "$id": "observation.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "EyeON Observation",
  "type": "object",
  "required": ["bytecount", "filename", "filetype", "magic", "md5", "observation_ts", "sha1", "sha256", "uuid"],
  "properties": {
    "bytecount": {
      "type":"integer",
      "description": "Size of file in bytes"
    },
    "compiler": {
      "type": "string",
      "description": "Compiler Identifier"
    },
    "filename": {
      "type": "string",
      "description": "Basename of file"
    },
    "filetype": {
      "type": "string",
      "enum": [ "elf", "pe", "macho", "other" ]
    },
    "imphash": {
      "type": "string",
      "description": "Import Hash calculated via pefile"
    },
    "telfhash": {
      "type": "string",
      "description": "Import hashing technique used on ELF files"
    },
    "magic": {
      "type": "string",
      "description": "`file` Magic output for given file"
    },
    "md5": {
      "type": "string",
      "description": "MD5 of file"
    },
    "modtime": {
      "type": "string",
      "description": "Last modified date"
    },
    "observation_ts": {
      "type": "string",
      "description": "Date and time file was scanned"
    },
    "parent": {
      "type": "string",
      "description": "Some yet-to-be-determined pointer to a parent file or something"
    },
    "permissions": {
      "type": "string",
      "description": "Permissions of file"
    },
    "sha1": {
      "type": "string",
      "description": "Sha1 of file"
    },
    "sha256": {
      "type": "string",
      "description": "Sha256 of file"
    },
    "ssdeep": {
      "type": "string",
      "description": "Ssdeep of file"
    },
    "target_os": {
      "type": "string",
      "description": "Operating system of target machine"
    },
    "uuid": {
      "type": "string",
      "description": "Universally Unique Identifier"
    },
    "authentihash": {
      "type": "string",
      "description": "Authentihash computed from signature hashing algorithm"
    },
    "authenticode_integrity": {
      "type": "string",
      "description": "Checks if signatures are OK and if digest matches hashed authenticode"
    },
    "metadata": {
      "type": "object", 
      "oneOf": [
        { "$ref": "#/$defs/PEMetadata" },
        { "$ref": "#/$defs/ELFMetadata" },
        { "$ref": "#/$defs/MachOMetadata" },
        { "$ref": "#/$defs/OtherMetadata" }
      ]
    },
    "defaults": {
      "$ref": "#/$defs/defaults"
    },
    "signatures": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "certs": {
            "$ref": "#/$defs/certs"
          },
          "signers": { "type": "string" },
          "digest_algorithm": { "type": "string" },
          "verification": { "type": "string" },
          "sha1": { "type": "string" }
        },
        "required": ["signers", "digest_algorithm"]
      }
    },
    "detect_it_easy": {
      "type": "string",
      "description": "Program that determines types of files for Windows, Linux and MacOS"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "certs": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "sha256": { "type": "string" }, 
          "issuer_sha256": { "type": "string" }, 
          "cert._version": { "type": "string" },
          "serial_number": { "type": "string" },
          "issuer_name": { "type": "string" },
          "subject_name": { "type": "string" },
          "issued_on": { "type": "string"},
          "expires_on": { "type": "string"},
          "signed_using": { "type": "string" },
          "RSA_key_size": { "type": "string" },
          "basic_constraints": { "type": "string" },
          "key_usage": { "type": "string" },
          "ext_key_usage": { "type": "string" },
          "certificate_policies": { "type": "string" }
       }
     }
    },
    "PEMetadata": {
      "type": "object",
      "properties": {
        "OS": { "type": "string" },
        "peMachine": { "type": "string" },
        "peOperatingSystemVersion": { "type": "string" },
        "peSubsystemVersion": { "type": "string" },
        "peSubsystem": { "type": "string" },
        "peLinkerVersion": { "type": "string" },
        "peImport": { "type": "array",
            "items": { "type": "string" }
        },
        "peIsExe": { "type": "boolean" }, 
        "peIsDll": { "type": "boolean" }, 
        "peIsClr": { "type": "boolean" }, 
        "FileInfo": { "type": "object" }, 
        "dllRedirectionLocal": { "type": "boolean" }
      }

    },
    "ELFMetadata": {
      "type": "object",
      "properties": {
         "OS": { "type": "string" },
        "elfIdent": {
          "type": "object",
          "properties": {
            "EI_CLASS": { "type": "integer" },
            "EI_DATA": { "type": "integer" },
            "EI_VERSION": { "type": "integer" },
            "EI_OSABI": { "type": "integer" },
            "EI_ABIVERSION": { "type": "integer" },
            "E_MACHINE": { "type": "integer" }
          }
        },
        "elfDependencies": { "type": "array" },
        "elfRpath": { "type": "array" },
        "elfRunpath": { "type": "array" },
        "elfSoname": { "type": "array" },
        "elfInterpreter": { "type": "array" },
        "elfDynamicFlags": { "type": "array" },
        "elfDynamicFlags1": { "type": "array" },
        "elfGnuRelro": { "type": "boolean" },
        "elfComment": { "type": "array" },
        "elfNote": { "type": "array" },
        "elfOsAbi": { "type": "string" },
        "elfHumanArch": { "type": "string" },
        "elfArchNumber": { "type": "integer" },
        "elfArchitecture": { "type": "string" },
        "elfIsExe": { "type": "boolean" },
        "elfIsLib": { "type": "boolean" },
        "elfIsRel": { "type": "boolean" },
        "elfIsCore": { "type": "boolean" }
      }
    },
    "MachOMetadata": {
      "type": "object",
      "properties": {
        "OS": { "type": "string" },
        "binaries": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "format": { "type": "string" },
              "header": {
                "type": "object",
                "properties": {
                  "cpuType": { "type": "string" },
                  "cpuTypeValue": { "type": "integer" },
                  "cpuSubtype": { "type": "string" },
                  "cpuSubtypeValue": { "type": "integer" },
                  "fileType": { "type": "string" },
                  "fileTypeValue": { "type": "integer" },
                  "flags": { "type": "array" },
                  "numCommands": { "type": "integer" }
                }
              }
            }
          }
        },
        "build": {
          "type": "object",
          "properties": {
            "platform": { "type": "string" },
            "platformValue": { "type": "integer" },
            "minOSVersion": { "type": "string" },
            "sdkVersion": { "type": "string" },
            "tools": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tool": { "type": "string" },
                  "version": { "type": "string" }
                }
              }
            }
          }
        },
        "signature": {
          "type": "object",
          "properties": {
            "offset": { "type":"integer" },
            "size": { "type":"integer" },
            "type": { "type":"string" }
          }
        },
        "dependencies": {
          "type": "array",
          "items": {
            "name": { "type": "string" },
            "currentVersion": { "type": "string" },
            "compatibilityVersion": { "type": "string" }
          }
        },
        "rpaths": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dyld": {
          "type": "object",
          "properties": {
            "linker": { "type": "string" }
          }
        },
        "encryption": { "type": "object" }
      }
    },
    "OtherMetadata": {
      "type": "object",
      "properties": {}
    },
    "defaults": {
      "type": "object",
      "properties": {
        "default_filename": { "type": "string" },
        "manufacturer_org": { "type": "string" },
        "location": {
          "type": "object",
          "properties": {
            "location": { "type": "string" },
            "filelocation": { "type": "string" }
          }
        },
        "machines": {
          "type": "object",
          "properties": {
            "machines": { "type": "string" },
            "os": { "type": "string" },
            "version": { "type": "string" },
            "x-version": { "type": "string" }
          }
        }
      }
    }
  }
}
